<html>

<head>
	<title>Hex Tiles</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="css/darkly.css" >
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="js/three.js"></script>
	<script src="js/orbit.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ramda/0.23.0/ramda.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
	<script src="js/hexmap.js"></script>

		<style>
		body {
			margin: 0;
			background-color: black;
			color: #DDD
		}

		canvas {
			width: 100%;
			height: 100%;
		}

		.data-column {
			padding-top: 60px;
		}

	</style>
</head>
<body>
<div id="mainContainer" class="container-fluid">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
            aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
          <a class="navbar-brand" href="#">UK Hex Map</a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="active"><a id="party" href="#">Summary </a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Colour by Party <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li role="separator" class="divider"></li>
								<li><a href="#" id="colorCon">Con</a></li>
								<li><a href="#" id="colorDUP">DUP</a></li>
								<li><a href="#" id="colorInd">Ind</a></li>
								<li><a href="#" id="colorSDLP">SDLP</a></li>
								<li><a href="#" id="colorSF">SF</a></li>
								<li><a href="#" id="colorUUP">UUP</a></li>
								<li><a href="#" id="colorLab">Lab</a></li>
								<li><a href="#" id="colorSNP">SNP</a></li>
								<li><a href="#" id="colorLD">LD</a></li>
								<li><a href="#" id="colorUKIP">UKIP</a></li>
								<li><a href="#" id="colorGreen">Green</a></li>
								<li><a href="#" id="colorPC">PC</a></li>
              </ul>
            </li>
						<li><a href="#" id="rectangle">Rectangle</a></li>
						<li><a href="#" id="explode">Explode</a></li>
          </ul>
					<!--TODO - Postcode search? -->
          <!--<form class="navbar-form navbar-left">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form><--></-->
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Find out more <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Source code</a></li>
                <li><a href="#">Data Sources</a></li>
                <li><a href="#">Twitter</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

	<div id="maprow" class="row">
	<div id="mapcontainer" class="col-sm-9"></div>
		<div class="col-sm-3 data-column hidden-xs">
			<h2>ID: <span id="constId"></span></h2>	
			<h2>Name: <span id="constName"></span></h2>	
			<h2>County: <span id="countyName"></span></h2>
			<h2>Majority: <span id="majority"></span></h2>


			<!--Move to footer?-->
			<!--<p>Created by Daniel Wright</p>
			<a href="https://github.com/daalwr/3dmap">Github</a></p>
			<p>Hexagon layout from <a href="https://github.com/odileeds/hexmaps">https://github.com/odileeds/hexmaps</a> and 2015 election results data from <a href="http://www.data.parliament.uk/dataset/general-election-2015">http://www.data.parliament.uk/dataset/general-election-2015</a></p>-->
		</div>
	</div>
</div>

	<script>
		var data = $.ajax({
			url: "data/combined3.json",
			dataType: "application/json",
			async: false
		});
		var data = JSON.parse(data.responseText);


		// Colouring Functions
		const colorCon = new THREE.Color(0x2254F4);
		const colorDUP = new THREE.Color(0x4f4c9a);
		const colorInd = new THREE.Color(0xdfdfdf);
		const colorSDLP = new THREE.Color(0xfbb675);
		const colorSF = new THREE.Color(0xb6c727);
		const colorUUP = new THREE.Color(0xEF3AAB);
		const colorLab = new THREE.Color(0xD60303);
		const colorSNP = new THREE.Color(0xFF6700);
		const colorLD = new THREE.Color(0xF9BC26);
		const colorUKIP = new THREE.Color(0x722EA5);
		const colorGreen = new THREE.Color(0x0DBC37);
		const colorPC = new THREE.Color(0x1DD3A7);
		const colorSpk = new THREE.Color(0x909090);


		const colorWithParty = obj => {
			switch (obj.first_party) {
				case "Con": return colorCon;
				case "DUP": return colorDUP;
				case "Ind": return colorInd;
				case "SDLP": return colorSDLP;
				case "SF": return colorSF;
				case "UUP": return colorUUP;
				case "Lab": return colorLab;
				case "SNP": return colorSNP;
				case "LD": return colorLD;
				case "UKIP": return colorUKIP;
				case "Green": return colorGreen;
				case "PC": return colorPC;
				case "Spk": return colorSpk;
				default: return new THREE.Color(0x000000);
			}
		}

		function scaleColor(votes, color, maxVote) {
			const colorCopy = new THREE.Color(color)
			var scale = votes / maxVote
			if(scale > 1) {
				scale = 1
			}
			return colorCopy.multiplyScalar(scale)
		}

		const values = R.values(data)

		function calculateMaxVote(getVotesFunc) {
			return R.reduce((a,b) => R.max(a,b), 0, R.map(getVotesFunc, values))
		}

		const maxConVote = calculateMaxVote(obj => parseInt(obj.con)) 
		const maxDUPVote = calculateMaxVote(obj => parseInt(obj.dup)) 
		const maxIndVote = calculateMaxVote(obj => parseInt(obj.other)) 
		const maxSDLPVote = calculateMaxVote(obj => parseInt(obj.sdlp)) 
		const maxSFVote = calculateMaxVote(obj => parseInt(obj.sf)) 
		const maxUUPVote = calculateMaxVote(obj => parseInt(obj.uup)) 
		const maxLabVote = calculateMaxVote(obj => parseInt(obj.lab)) 
		const maxSNPVote = calculateMaxVote(obj => parseInt(obj.snp)) 
		const maxLDVote = calculateMaxVote(obj => parseInt(obj.ld)) 
		const maxUKIPVote = calculateMaxVote(obj => parseInt(obj.ukip)) 
		const maxGreenVote = calculateMaxVote(obj => parseInt(obj.green)) 
		const maxPCVote = calculateMaxVote(obj => parseInt(obj.pc)) 

		const colorWithCon = obj => {return scaleColor(obj.con, colorCon, maxConVote)}
		const colorWithDUP = obj => {return scaleColor(obj.dup, colorDUP, maxDUPVote)}
		const colorWithInd = obj => {return scaleColor(obj.other, colorInd, maxIndVote)}
		const colorWithSDLP = obj => {return scaleColor(obj.sdlp, colorSDLP, maxSDLPVote)}
		const colorWithSF = obj => {return scaleColor(obj.sf, colorSF, maxSFVote)}
		const colorWithUUP = obj => {return scaleColor(obj.uup, colorUUP, maxUUPVote)}
		const colorWithLab = obj => {return scaleColor(obj.lab, colorLab, maxLabVote)}
		const colorWithSNP = obj => {return scaleColor(obj.snp, colorSNP, maxSNPVote)}
		const colorWithLD = obj => {return scaleColor(obj.ld, colorLD, maxLDVote)}
		const colorWithUKIP = obj => {return scaleColor(obj.ukip, colorUKIP, maxUKIPVote)}
		const colorWithGreen = obj => {return scaleColor(obj.green, colorGreen, maxGreenVote)}
		const colorWithPC = obj => {return scaleColor(obj.pc, colorPC, maxPCVote)}

		// Height Functions
		const heightToMajority = obj => {
			return parseInt(obj.majority) / 3000
		}

		const heightToCon = obj => {return parseInt(obj.con) / 3000}
		const heightToDUP = obj => {return parseInt(obj.dup) / 3000}
		const heightToInd = obj => {return parseInt(obj.other) / 3000}
		const heightToSDLP = obj => {return parseInt(obj.sdlp) / 3000}
		const heightToSF = obj => {return parseInt(obj.sf) / 3000}
		const heightToUUP = obj => {return parseInt(obj.uup) / 3000}
		const heightToLab = obj => {return parseInt(obj.lab) / 3000}
		const heightToSNP = obj => {return parseInt(obj.snp) / 3000}
		const heightToLD = obj => {return parseInt(obj.ld) / 3000}
		const heightToUKIP = obj => {return parseInt(obj.ukip) / 3000}
		const heightToGreen = obj => {return parseInt(obj.green) / 3000}
		const heightToPC = obj => {return parseInt(obj.pc) / 3000}

		const generateOpacity = obj => { return 0.5 }

		const hoverCallback = (constId) => {
			const foundData = data[constId]
			$("#constId").text(foundData.id);
			$("#constName").text(foundData.n);
			$("#countyName").text(foundData.county_name);
			$("#majority").text(foundData.majority);
		}

		// Layout Functions

		const mapPosition = obj => {
			return {x: obj.originX, y: obj.originY}
		}

		generateHexMap(data, colorWithParty, heightToMajority, generateOpacity, hoverCallback)
		
		// Button wiring
		$( "#party" ).click(function() {
			animateTo(colorWithParty, heightToMajority, mapPosition)
		});
		$('#colorCon').click(function() {animateTo(colorWithCon, heightToCon, mapPosition)})
		$('#colorDUP').click(function() {animateTo(colorWithDUP, heightToDUP, mapPosition)})
		$('#colorInd').click(function() {animateTo(colorWithInd, heightToInd, mapPosition)})
		$('#colorSDLP').click(function() {animateTo(colorWithSDLP, heightToSDLP, mapPosition)})
		$('#colorSF').click(function() {animateTo(colorWithSF, heightToSF, mapPosition)})
		$('#colorUUP').click(function() {animateTo(colorWithUUP, heightToUUP, mapPosition)})
		$('#colorLab').click(function() {animateTo(colorWithLab, heightToLab, mapPosition)})
		$('#colorSNP').click(function() {animateTo(colorWithSNP, heightToSNP, mapPosition)})
		$('#colorLD').click(function() {animateTo(colorWithLD, heightToLD, mapPosition)})
		$('#colorUKIP').click(function() {animateTo(colorWithUKIP, heightToUKIP, mapPosition)})
		$('#colorGreen').click(function() {animateTo(colorWithGreen, heightToGreen, mapPosition)})
		$('#colorPC').click(function() {animateTo(colorWithPC, heightToPC, mapPosition)})
		$('#rectangle').click(function() {rectangleHexMap()})
		$('#explode').click(function() {explodeHexMap()})

	</script>
</body>

</html>